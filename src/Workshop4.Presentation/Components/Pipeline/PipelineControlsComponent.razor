@using Phazor.Components.Models
@using Workshop4.Presentation.Execution
@using Workshop4.Presentation.Execution.Actions
@using Workshop4.Presentation.Execution.DebugExecution
@using Workshop4.Presentation.Execution.RunExecution
@using Workshop4.Presentation.Models
@using Workshop4.Presentation.Services

@namespace Workshop4.Presentation.Components.Pipeline


<PhazorHStack
    Style="flex-grow: 0"
    Horizontal="HorizontalDistribution.Left"
    Gap="10px">

    <MudButton
        Variant="Variant.Filled"
        Color="Color.Primary"
        StartIcon="@Icons.Material.Filled.PlayArrow"
        Disabled="@AppState.Instance.IsExecuting"
        OnClick="@(() => OnExecuteClicked.InvokeAsync(new RunExecutionStrategyFactory()))">
        Run
    </MudButton>
    <MudButton
        Variant="Variant.Filled"
        Color="Color.Success"
        StartIcon="@Icons.Material.Filled.BugReport"
        Disabled="@AppState.Instance.IsExecuting"
        OnClick="@(() => OnExecuteClicked.InvokeAsync(new DebugExecutionStrategyFactory()))">
        Debug
    </MudButton>

</PhazorHStack>

<PhazorHStack
    Style="flex-grow: 0"
    Horizontal="HorizontalDistribution.Left"
    Gap="10px">

    @if (ExecutionStrategy is not null)
    {
        var builder = new ExecutionActionsBuilder();
        ExecutionStrategy.ActionLink.Configure(builder, ExecutionStrategy);

        foreach (RenderFragment fragment in builder.Fragments)
        {
            @fragment
        }
    }


</PhazorHStack>

@code {

    [Parameter]
    [EditorRequired]
    public IExecutionStrategy? ExecutionStrategy { get; set; }

    [Parameter]
    [EditorRequired]
    public EventCallback<IExecutionStrategyFactory> OnExecuteClicked { get; set; }

}
@namespace Workshop4.Presentation.Components.Nodes
@using System.Diagnostics.CodeAnalysis
@using Phazor.Components.Models
@using Workshop4.Application.Pipelines.Nodes
@using Workshop4.Application.Pipelines.Operation
@using Workshop4.Presentation.Services

<MudCard Class="node-card" Elevation="0">

    <MudCardHeader>
        <PhazorHStack
            Horizontal="HorizontalDistribution.Left"
            Variant="PhazorStackVariant.Compact"
            Gap="5px">

            <MudIcon Icon="@Icons.Material.Filled.FilterList"/>
            <MudText Typo="Typo.subtitle1">Filter</MudText>

        </PhazorHStack>
    </MudCardHeader>

    <MudCardContent>
        <PhazorHStack
            Horizontal="HorizontalDistribution.Between"
            Vertical="VerticalAlignment.Top"
            Gap="10px">

            <MudTextField
                @bind-Value="Node.PropertyName"
                Label="Field"
                Variant="Variant.Outlined"
                FullWidth="true"
                Disabled="@AppState.Instance.IsExecuting"/>

            <MudSelect
                T="IFilterOperation"
                @bind-Value="Node.FilterOperation"
                Label="Operation"
                Variant="Variant.Outlined"
                FullWidth="true"
                Disabled="@AppState.Instance.IsExecuting"
                ToStringFunc="op => op?.Name">

                @foreach (IFilterOperation operation in Operations)
                {
                    <MudSelectItem T="IFilterOperation" Value="@operation"/>
                }

            </MudSelect>

            <MudTextField
                @bind-Value="Node.Value"
                Label="Value"
                Variant="Variant.Outlined"
                FullWidth="true"
                Disabled="@AppState.Instance.IsExecuting"/>

        </PhazorHStack>
    </MudCardContent>
</MudCard>

@code {

    private static readonly IFilterOperation[] Operations =
    [
        new EqualsOperation(),
        new NotEqualsOperation(),
        new GreaterThanOperation(),
        new LessThanOperation(),
    ];

    [NotNull]
    [Parameter]
    [EditorRequired]
    public required FilterNode? Node { get; set; }

}